{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load blog_extras %}
{% block title %}
  Community Posts
{% endblock %}
{% block css %}
  <link rel="stylesheet" href="{% static 'css/blog_posts/all_posts.css' %}" />
{% endblock %}

{% block content %}
  <section class="container py-5">
    <header class="d-flex align-items-center justify-content-between mb-4">
      <h1 class="h2 mb-0">Community Posts</h1>
      {% if user.is_authenticated %}
        <a href="{{ create_post_url }}" class="btn btn-primary" aria-label="Create Post">Create Post</a>
      {% else %}
        <a href="{{ login_url }}" class="btn btn-primary" aria-label="Create Post">Login to write post</a>
      {% endif %}
    </header>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <p>Connect with like-minded individuals and share your thoughts!</p>
    </div>
    {% if posts %}
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for post in posts %}
          <div class="col-12">
            <a href="{% url 'post_details' post.id %}" class="text-decoration-none text-reset d-block h-100">
              <article class="card border-0 shadow-sm hover-card h-100">
                <div class="card-body">
                  <h2 class="h4 card-title mb-2 line-clamp-2">{{ post.title }}</h2>
                  <div class="d-flex align-items-center gap-2 mb-2 small text-muted">
                    {% if post.created_at %}
                      <time datetime="{{ post.created_at|date:'c' }}">{{ post.created_at|date:'d M, Y' }}</time>
                      <span>•</span>
                    {% endif %}
                    {% if post.author %}
                      <span>By {{ post.author }}</span><span>•</span>
                    {% endif %}
                  </div>
                  <p class="card-text text-body-secondary mb-3 line-clamp-3">
                      {{ post.content|content_preview:40 }}
                  </p>
                </div>

                <div class="card-footer bg-transparent border-0 pt-0">
                  <span class="fw-medium">Read more →</span>
                </div>
              </article>
            </a>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-info mb-0" role="alert">No posts yet.</div>
    {% endif %}
  </section>
{% endblock %}
