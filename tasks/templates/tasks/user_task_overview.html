{% extends 'base.html' %}
{% load static %}
{% block title %}
  Task Overview
{% endblock %}

{% block css %}
  <link rel="stylesheet" href="{% static 'css/tasks/user_task_overview.css' %}" />
{% endblock %}

{% block content %}
  <section class="container py-5">
    <header class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <h1 class="h2 mb-0">Task Overview</h1>
        <p class="text-muted">
          Your Task Slots: <span>{{ open_tasks_count }}/{{ subscription.tasks_quota }}</span>
        </p>
      </div>

      {% if not perms.tasks.mark_done %}
        <div class="d-flex align-items-center flex-column">
          <a href="{% url 'add_task' %}" class="btn btn-primary {% if not can_add_task %}disabled{% endif %}" aria-label="Add Task">Add Task</a>
          {% if tasks_with_fee.count >= 1 %}
            <p class="text-muted mt-2">You can not add tasks until you paid your fees</p>
          {% elif not can_add_task %}
            <p class="text-muted mt-2">You have reached your task limit.</p>
          {% endif %}
        </div>
      {% endif %}
    </header>
    {% comment %}Due Task{% endcomment %}
    {% comment %} {% if tasks_undone %}
      <section class="mb-5" aria-labelledby="due-tasks">
        <h2 id="open-tasks" class="h4 mb-3">Almost Due Tasks</h2>
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for task in tasks_undone %}
            <div class="col">
              {% include 'tasks/_task_card.html' with task=task %}
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %} {% endcomment %}

    <!-- Open / Undone -->
    <section class="mb-5" aria-labelledby="open-tasks">
      <h2 id="open-tasks" class="h4 mb-3">Open Tasks</h2>
      {% if tasks_undone and tasks_undone.count > 0 and not task.is_due_soon %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for task in tasks_undone %}
            <div class="col">
              {% include 'tasks/_task_card.html' with task=task %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info mb-0" role="alert">You have no current tasks.</div>
      {% endif %}
    </section>

    {% comment %}Fees to pay{% endcomment %}
    {% if tasks_with_fee and tasks_with_fee.count > 0 %}
      <section class="mb-5" aria-labelledby="fees-to-pay">
        <h2 id="fees-to-pay" class="h4 mb-3">Fees to Pay</h2>
        {% if tasks_with_fee and tasks_with_fee.count > 0 %}
          <div class="d-flex justify-content-end mb-2">
            <a class="btn btn-warning" href="{% url 'pay_all_fees' %}">Pay all fees at once</a>
          </div>
          <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for task in tasks_with_fee %}
              <div class="col">
                {% include 'tasks/_task_card.html' with task=task %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info mb-0" role="alert">No fee to pay.</div>
        {% endif %}
      </section>
    {% endif %}
    <!-- Done -->
    <section aria-labelledby="done-tasks">
      <h2 id="done-tasks" class="h4 mb-3">Done Tasks</h2>
      {% if tasks_done and tasks_done.count > 0 %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for task in tasks_done %}
            <div class="col">
              {% include 'tasks/_task_card.html' with task=task %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-secondary mb-0" role="alert">No tasks completed yet.</div>
      {% endif %}
    </section>
  </section>
{% endblock %}
