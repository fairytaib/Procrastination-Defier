{% extends 'base.html' %}
{% load static %}

{% block title %}
  Your Profile
{% endblock %}
{% block css %}
{% endblock %}

{% block content %}
  <section class="container py-5">
    <!-- Header -->
    <header class="mb-4">
      <h1 class="h3 mb-0">Your profile</h1>
    </header>

    <div class="row g-4">
      <!-- Left: Avatar + quick actions -->
      <div class="col-md-4">
        <article class="card border-0 shadow-sm h-100">
          <div class="card-body d-flex flex-column align-items-center text-center">
            <!-- Avatar (with fallback image) -->
            <div class="ratio ratio-1x1 w-75 w-md-100 rounded-circle overflow-hidden mb-3">
              
              {% if profile.profile_picture %}
                <img src="{{ profile.profile_picture.url }}" alt="{{ profile.user.username }}'s profile picture" class="w-100 h-100 object-fit-cover" />
              {% else %}
                <img src="{% static 'images/placeholder/default_profile_image.webp' %}" alt="{{ profile.user.username }}'s profile picture" class="w-100 h-100 object-fit-cover" />
              {% endif %}
            </div>

            <!-- Name + email -->
            <h2 class="h5 mb-1">{{ profile.user.get_full_name|default:profile.user.username }}</h2>
            <div class="small text-body-secondary">{{ profile.user.email }}</div>

            <!-- Actions -->
            <div class="d-grid gap-2 w-100 mt-3">
              <a href="{% url 'account_update' %}" class="btn btn-primary" aria-label="Edit profile">Edit profile</a>
              <a href="{% url 'account_change_password' %}" class="btn btn-outline-secondary" aria-label="Change password">Change password</a>
            </div>
          </div>
        </article>
      </div>

      <!-- Right: Details -->
      <div class="col-md-8">
        <article class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <h3 class="h5 mb-3">Account details</h3>

            <dl class="row mb-0">
              <dt class="col-sm-4">Username</dt>
              <dd class="col-sm-8">{{ profile.user.username }}</dd>

              <dt class="col-sm-4">Email</dt>
              <dd class="col-sm-8">{{ profile.user.email }}</dd>

              <dt class="col-sm-4">First name</dt>
              <dd class="col-sm-8">{{ profile.user.first_name|default:'—' }}</dd>

              <dt class="col-sm-4">Last name</dt>
              <dd class="col-sm-8">{{ profile.user.last_name|default:'—' }}</dd>

              <dt class="col-sm-4">Member since</dt>
              <dd class="col-sm-8"><time datetime="{{ profile.created_at|date:'c' }}">{{ profile.created_at }}</time></dd>
              
              <dt class="col-sm-4">Your Points</dt>
              <dd class="col-sm-8">{{ user_points.points }}</dd>
            </dl>
            <a class="btn btn-primary mt-4"
               aria-label="View subscription details"
               {% if user.is_authenticated and subscription_check %}
                 href="{% url 'subscriptions_overview' %}"
               {% else %}
                 href="{{ subscription_view_url }}"
               {% endif %}>My Subscription
            </a>
          </div>
        </article>
      </div>
    </div>
  </section>
{% endblock %}
